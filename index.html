<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Walmart — AI Grocery Assistant (Embed)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="style.css?v=2025-11-06" />
</head>
<body>
  <!-- Background Walmart mock (desktop + mobile auto) -->
  <div class="bg">
    <picture>
      <source srcset="walmart_mock_mobile.png?v=1" media="(max-width:768px)">
      <img id="mock" src="walmart_mock_.png?v=16" alt="Walmart search results mock" />
    </picture>
  </div>

  <!-- Walmart header launcher (stays on page; opens overlay) -->
  <div class="wm-bar" id="wmLaunch" role="button" aria-label="Open Walmart AI Assistant">
    <div class="wm-brand" aria-hidden="true">
      <div class="spark"></div>
      <div class="wm-word">Walmart</div>
    </div>
    <div class="wm-title">— AI Grocery Assistant</div>
    <div class="spacer" aria-hidden="true"></div>
  </div>

  <!-- Floating launcher pill (mobile only via CSS) -->
  <div class="launcher" id="dotLaunch" aria-label="Open Walmart AI">
    <div class="halo" aria-hidden="true"></div>
    <div>Walmart&nbsp;AI</div>
  </div>

  <!-- Overlay with iframe -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true" aria-label="Walmart AI Assistant">
      <div class="panel-header">
        <div class="panel-title">
          <div class="spark" aria-hidden="true"></div>
          <div>Walmart — AI Grocery Assistant</div>
        </div>
        <button class="close" id="closeBtn" aria-label="Close">×</button>
      </div>
      <div class="panel-body">
        <iframe
          id="voxFrame"
          src="https://walmart-business-example.onrender.com/?src=wm-embed"
          allow="microphone; autoplay; clipboard-read; clipboard-write"
          referrerpolicy="no-referrer"
          title="Embedded Walmart AI Assistant"
        ></iframe>

        <!-- Fallback if iframe won't load due to X-Frame-Options/CSP -->
        <div class="fallback" id="fallback" role="region" aria-live="polite">
          <div>
            <h3>Open Walmart AI in a new tab</h3>
            <p>If the assistant doesn’t appear here, your browser blocked embedding. You can still use it in a separate tab.</p>
            <a href="https://walmart-business-example.onrender.com/?src=wm-newtab" target="_blank" rel="noopener">Open Walmart AI</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const overlay   = document.getElementById('overlay');
    const wmLaunch  = document.getElementById('wmLaunch');
    const dotLaunch = document.getElementById('dotLaunch');
    const closeBtn  = document.getElementById('closeBtn');
    const voxFrame  = document.getElementById('voxFrame');
    const fallback  = document.getElementById('fallback');

    function openOverlay(){
      overlay.style.display = 'block';
      overlay.setAttribute('aria-hidden','false');

      // Graceful fallback if embed is blocked
      fallback.style.display = 'none';
      const check = setTimeout(()=>{ fallback.style.display='flex'; }, 2200);
      const onLoad = () => { clearTimeout(check); voxFrame.removeEventListener('load', onLoad); };
      voxFrame.addEventListener('load', onLoad);
    }

    function closeOverlay(){
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden','true');
      // Optional: hard reset to stop audio/session
      // voxFrame.src = voxFrame.src;
    }

    wmLaunch.addEventL
